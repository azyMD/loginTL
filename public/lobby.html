<!-- public/lobby.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TicTacToe Lobby</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="container">
    <h1>TicTacToe Lobby</h1>
    <ul id="players-list"></ul>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const playersList = document.getElementById('players-list');

    const params = new URLSearchParams(window.location.search);
    const userId = params.get('userId');

    // Join the lobby
    socket.emit('joinLobby', { userId });

    socket.on('onlinePlayers', (players) => {
      playersList.innerHTML = '';
      players.forEach((p) => {
        if (p.userId == userId) return; // skip self

        const li = document.createElement('li');
        li.textContent = `${p.displayName} ${p.inGame ? '(In Game)' : ''}`;

        if (!p.inGame) {
          const challengeBtn = document.createElement('button');
          challengeBtn.textContent = 'Challenge';
          challengeBtn.onclick = () => {
            socket.emit('challengePlayer', {
              challengerId: userId,
              challengedId: p.userId
            });
          };
          li.appendChild(challengeBtn);
        }
        playersList.appendChild(li);
      });
    });

    socket.on('gameStarted', ({ gameId, opponentId }) => {
      window.location.href = `/game.html?gameId=${gameId}&userId=${userId}&opponentId=${opponentId}`;
    });

    socket.on('errorMsg', (msg) => {
      alert(msg);
    });
  </script>
</body>
</html>
